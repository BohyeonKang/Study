##2과목 SQL 기본 및 활용

- 20문제
- 각 상황별로 SQL문 작성이 가능할 정도로 연습해야 합니다.
- 기본적인 SQL문법 및 함수는 생략하고 Tuning에 활용될수 있는 것 위주로 정리하고자 합니다.

###2장 SQL 활용 (#3)

####WINDOW FUNCTION (윈도우 함수)

- 행과 행간을 비교, 연산하는 함수

#####종류
1. 순위 관련 : RANK, DENSE_RANK, ROW_NUMBER
2. 집계 관련 : SUM, MAX, MIN, AVG, COUNT
3. 순서 관련 : FIRST_VALUE, LAST_VALUE, LAG, LEAD
4. 비율 관련 : CUME_DIST, PERCENT_RANK, NTILE, RATIO_TO_REPORT
5. 통계 분석 (순형 분석 포함) : CORP, COVAR_POP, STDDEV 등... (여기서는 다루지 않음)

#####문법 (syntax)

```SQL
SELECT 함수명 (인자) OVER
        ([PARTITION BY 칼럼] [ORDER BY 절] [WINDOWING 절])
  FROM 테이블;
```

- PARTITION BY 절 : 전체 집합을 기준에 의해 소그룹으로 분리
- ORDER BY 절 : 순위 지정시 그 순서
- WINDOWING 절 : 함수의 대상을 지정
  - ROWS : 물리적인 행수를 지정
  - RANGE : 논리적인 값에 의한 범위 지정
```SQL
-- BETWEEN 사용 타입
ROWS | RANGE BETWEEN
  UNBOUNDED PRECEDING | CURRENT ROW | VALUE_EXPR PRECEDING/FOLLOWING
AND
  UNBOUNDED FOLLOWING | CURRENT ROW | VALUE_EXPR PRECEDING/FOLLOWING

-- BETWEEN 미사용 타입
ROWS | RANGE
  UNBOUNDED PRECEDING | CURRENT ROW | VALUE_EXPR PRECEDING
```

#####1. 순위 함수

* RANK : 특정 칼럼에 대한 순위를 구함
```SQL
SELECT JOB, ENAME, SAL,
       RANK() OVER (ORDER BY SAL DESC) ALL_RANK,                  -- SAL의 DESC 순서로 RANK
       RANK() OVER (PARTITION BY JOB ORDER BY SAL DESC) JOB_RANK  -- JOB별로 SAL의 DESC 순서로 RANK
  FROM SCOTT.EMP;
```
![image](https://github.com/DevStarSJ/Study/blob/master/Blog/Oracle/sqlp/image/02.04.window.01.png?raw=true)

한문장에 RANK가 2개 이상일 경우 먼저 나온것을 기준으로 ORDER BY된 결과가 나온다.  
`JOB_RANK`를 먼저 썼을 경우에는 `ORDER BY JOB, SAL DESC` 와 같은 순서로 결과가 나온다.

* DENSE_RANK : 동일한 순위를 하나의 건수로 계산한다.

* ROW_NUMBER : 동일한 순위에 대해서도 등수를 따로 매긴다. (Oracle의 경우 rowid가 낮은게 먼저 나옴)

```SQL
SELECT JOB, ENAME, SAL,
       RANK()       OVER (ORDER BY SAL DESC) RANK,
       DENSE_RANK() OVER (ORDER BY SAL DESC) DENSE_RANK,
       ROW_NUMBER() OVER (ORDER BY SAL DESC) ROW_NUMBER
  FROM SCOTT.EMP;
```
![image](https://github.com/DevStarSJ/Study/blob/master/Blog/Oracle/sqlp/image/02.04.window.02.png?raw=true)
앞의 결과를 보면
- RANK의 경우 2위가 2개이고 다음이 4위인데,
- DENSE_RANK는 2위가 2개이고 다음이 3위이다.
- ROW_NUMBER는 1 ~ 14로 모든 row의 순위가 다르다.

#####2. 집계 함수

* SUM 

